# JinGo VPN - 架构说明

## 概述

JinGo VPN 是一个跨平台 VPN 客户端，使用 Qt 6 + QML 构建用户界面。

## 系统架构

```
┌─────────────────────────────────────────────────────────────┐
│                        JinGo 应用                           │
├─────────────────────────────────────────────────────────────┤
│  ┌──────────────────────────────────────────────────────┐  │
│  │                    QML 界面层                         │  │
│  │  ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐    │  │
│  │  │ 首页    │ │ 服务器  │ │ 设置    │ │ 个人中心│    │  │
│  │  └─────────┘ └─────────┘ └─────────┘ └─────────┘    │  │
│  └──────────────────────────────────────────────────────┘  │
│                            │                                │
│                            ▼                                │
│  ┌──────────────────────────────────────────────────────┐  │
│  │                 JinDoCore 静态库                      │  │
│  │      (核心业务逻辑、API、VPN 管理 - 预编译)           │  │
│  └──────────────────────────────────────────────────────┘  │
│                            │                                │
│                            ▼                                │
│  ┌──────────────────────────────────────────────────────┐  │
│  │                    平台适配层                         │  │
│  │  ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐    │  │
│  │  │ Android │ │  iOS    │ │ macOS   │ │ Windows │    │  │
│  │  │  Linux  │ │         │ │         │ │         │    │  │
│  │  └─────────┘ └─────────┘ └─────────┘ └─────────┘    │  │
│  └──────────────────────────────────────────────────────┘  │
│                            │                                │
│                            ▼                                │
│  ┌──────────────────────────────────────────────────────┐  │
│  │                 Superray (VPN 引擎)                   │  │
│  │          TUN 设备管理、流量转发、DNS 管理             │  │
│  └──────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────┘
```

## 目录结构

```
JinGo/
├── src/
│   ├── main.cpp              # 应用入口
│   └── platform/             # 平台特定代码
│       ├── android/
│       ├── apple/            # iOS + macOS
│       ├── linux/
│       └── windows/
├── qml/
│   ├── Main.qml              # 主界面
│   ├── pages/                # 页面
│   └── components/           # 组件
├── resources/
│   ├── icons/                # 图标
│   ├── translations/         # 翻译文件
│   └── geoip/                # GeoIP 数据
├── platform/
│   ├── android/              # Android 配置
│   └── ios/                  # iOS 配置
├── third_party/
│   ├── jindo/                # JinDoCore 静态库
│   ├── superray/             # VPN 引擎
│   └── *_openssl/            # OpenSSL 库
└── scripts/build/            # 构建脚本
```

## 平台适配

### Android
- 使用 `VpnService` 创建 VPN
- 通过 JNI 调用 Superray
- Socket 保护机制防止流量回环

### iOS
- 使用 `NEPacketTunnelProvider` 扩展
- App Groups 共享数据
- XPC 进程间通信

### macOS
- Root 模式直接创建 TUN 设备
- 或使用 Network Extension（沙盒模式）

### Windows
- 使用 WinTun 驱动
- 需要管理员权限安装驱动

### Linux
- 使用 `/dev/net/tun`
- 需要 `CAP_NET_ADMIN` 权限或 root

## VPN 连接流程

```
用户点击连接
      │
      ▼
┌─────────────┐
│ QML 界面    │
└──────┬──────┘
       │ connect()
       ▼
┌─────────────┐
│ VPNManager  │ ◄── 状态: Disconnected → Connecting
└──────┬──────┘
       │
       ▼
┌─────────────┐
│  Superray   │ ◄── 1. 创建 TUN 设备
└──────┬──────┘     2. 启动 Xray 引擎
       │            3. 配置路由
       ▼
┌─────────────┐
│ VPNManager  │ ◄── 状态: Connecting → Connected
└─────────────┘
```

## 依赖关系

```
JinGo (Qt 应用)
    │
    ├── JinDoCore (静态库) ─── third_party/jindo/
    │
    ├── Superray (动态库) ──── third_party/superray/
    │
    └── OpenSSL (静态库) ───── third_party/*_openssl/
```

所有依赖库已预编译，位于 `third_party/` 目录。

## 相关文档

- [构建指南](02_BUILD_GUIDE.md)
- [开发指南](03_DEVELOPMENT.md)
